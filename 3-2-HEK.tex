\subsection{HEK}\label{ssec:hek}

The Sun is an active star and exhibits a wide range of phenomena on
many different time-scales, length-scales and wavelengths.
Observations and metadata concerning these phenomena are collected at
the Heliophysics Event Knowledgebase (HEK).  Entries are generated
both by automated algorithms and human observers.  Some of the
information in the HEK reproduces feature/event data elsewhere (for
example, the GOES flare catalog), and some is generated by the Solar
Dynamics Observatory Feature Finding Team \cite{martens2012} to
populate the HEK.  The advantage of the HEK to SunPy is that it is a
single service that provides a homogeneous and well-described
interface to a large amount of feature/event information of interest
to the solar physics community.

SunPy accesses this information through the \texttt{hek} module, which
was developed through support from the European Space Agency Summer of
Code in Space (ESA-SOCIS) 2011.  The \texttt{hek} module makes use of
the HEK API
(\url{http://vso.stanford.edu/hekwiki/ApplicationProgrammingInterface?action=print}).
Every event type has required and optional properties; the current
list of events maintained by the HEK and their properties can be found
at \url{http://www.lmsal.com/hek/VOEvent_Spec.html}.

Simple HEK queries consist of start time, an end time, and an event
type (Example \ref{code:hek:simple}). Times can be specified in any
SunPy-acceptable format. Event types are specified as upper case, two
letter strings, and are identical to the two letter abbreviations
found at the HEK website, \url{http://www.lmsal.com/hek/VOEvent_Spec.html}.

\begin{listing}[H]
\begin{minted}{python}
from sunpy.net import hek
client = hek.HEKClient()
tstart = '2011/08/09 07:23:56'
tend = '2011/08/09 12:40:29'
event\_type = 'FL'
result = client.query(hek.attrs.Time(tstart,tend), 
hek.attrs.EventType(event\_type))
\end{minted}
\caption{Simple HEK query, returning 19 entries.}
\label{code:hek:simple}
\end{listing}

The module \texttt{hek.attrs} contains attributes of the HEK that can be used to
construct HEK queries.  For example, a flare is an attribute of the
HEK, and so instead of specifying \texttt{hek.attrs.EventType('FL')}
in Example \ref{code:hek:simple}, this can also be expressed as
\texttt{hek.attrs.FL}. 

HEK attributes differ from VSO attributes (Section \ref{ssec:vso}) in
that many of them are wrappers that conveniently expose
comparisions by overloading Python operators.  This allows filtering
of the HEK entries by the properties of the event.  As was mentioned
above, the HEK stores feature/event metadata obtained in different
ways, known generally as {\it feature recognition methods}, or FRMs.
Example \ref{code:hek:frm} filters the results of the previous result
to return only those events that have the FRM 'SSW Latest Events'.
\begin{listing}[H]
\begin{minted}{python}
result = client.query(hek.attrs.Time(tstart,tend), 
hek.attrs.EventType(event\_type), hek.attrs.FRM.Name == 'SSW Latest Events')
\end{minted}
\caption{An HEK query that returns only those flares that were
  detected by the 'SSW Latest Events' feature recognition method.}
\label{code:hek:frm}
\end{listing}
Multiple comparisons can be made by including more comma-separated
conditions on the attributes in the call to the HEK query method.

HEK comparisons can be combined using Pythonâ€™s logical operators AND
and OR. This makes complex queries easy to create: example
\ref{code:hek:or} returns flares west of 50 arcseconds or those that
have a peak flux above 1000.0 (the units of the flux are FRM dependent
and are described at the HEK website).
\begin{listing}[H]
\begin{minted}{python}
result = client.query(hek.attrs.Time(tstart,tend), 
hek.attrs.EventType(event\_type), (hek.attrs.Event.Coord1 > 50) or 
(hek.attrs.FL.PeakFlux > 1000.0) )
\end{minted}
\caption{HEK query using the 'or' operator.}
\label{code:hek:or}
\end{listing}
All FRMs report the required feature attributes (as described at
\url{http://www.lmsal.com/hek/VOEvent_Spec.html}), but the optional
attributes are FRM dependent.  If a FRM does not have one of the
optional attribute, a 'None' is returned by the \texttt{hek} module.

The ability to use comparison and logical operators on HEK attributes
allows the construction of queries of almost arbitrary complexity,
bringing powerful feature/event search capabilities to SunPy.
